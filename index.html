<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¨¸ë‹ˆì•± - ê°€ê²© ë¹„êµ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Apple SD Gothic Neo', sans-serif;
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            min-height: 100vh;
            padding: 20px;
            font-size: 14px;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            color: white;
            padding: 25px 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .header p {
            font-size: 13px;
            opacity: 0.9;
        }

        .content {
            padding: 20px;
        }

        .tab-buttons {
            display: flex;
            background: #f8f9fa;
            border-radius: 12px;
            padding: 4px;
            margin-bottom: 20px;
        }

        .tab-btn {
            flex: 1;
            padding: 12px;
            background: none;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            color: #666;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .tab-btn.active {
            background: white;
            color: #ff6b35;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #333;
            font-size: 13px;
        }

        .form-input {
            width: 100%;
            padding: 12px 14px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.2s ease;
            background: #fafbfc;
        }

        .form-input:focus {
            outline: none;
            border-color: #ff6b35;
            background: white;
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
        }

        .form-input:disabled {
            background: #f1f3f4;
            color: #666;
        }

        .unit-display {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .unit-display input {
            flex: 1;
        }

        .unit-label {
            font-size: 12px;
            color: #666;
            font-weight: 500;
        }

        .btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 10px;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .comparison-results {
            margin-top: 20px;
        }

        .result-item {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            border-left: 4px solid #ff6b35;
        }

        .result-item.best {
            background: linear-gradient(135deg, rgba(255, 107, 53, 0.1) 0%, rgba(247, 147, 30, 0.1) 100%);
            border-left-color: #28a745;
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .result-store {
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .result-price {
            font-weight: 700;
            color: #ff6b35;
            font-size: 15px;
        }

        .result-details {
            font-size: 12px;
            color: #666;
            display: flex;
            justify-content: space-between;
        }

        .best-badge {
            background: #28a745;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 8px;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .history-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e9ecef;
        }

        .history-title {
            font-size: 13px;
            font-weight: 600;
            color: #333;
            margin-bottom: 12px;
        }

        .history-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            font-size: 12px;
        }

        .history-product {
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }

        .history-details {
            color: #666;
            display: flex;
            justify-content: space-between;
        }

        .input-wrapper {
            position: relative;
        }

        .suggestion-box {
            position: absolute;
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            max-height: 150px;
            overflow-y: auto;
            z-index: 1000;
            width: 100%;
            margin-top: 2px;
        }

        .suggestion-item {
            padding: 10px 14px;
            cursor: pointer;
            font-size: 13px;
            border-bottom: 1px solid #f1f3f4;
            transition: background 0.2s ease;
        }

        .suggestion-item:hover {
            background: #f8f9fa;
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .suggestion-item-with-delete {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .suggestion-text {
            flex: 1;
            cursor: pointer;
        }

        .delete-suggestion-btn {
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 2px 6px;
            font-size: 10px;
            cursor: pointer;
            margin-left: 8px;
        }

        .delete-suggestion-btn:hover {
            background: #a71e2a;
        }

        .result-actions {
            margin-top: 10px;
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }

        .edit-btn, .delete-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .edit-btn {
            background: #007bff;
            color: white;
        }

        .edit-btn:hover {
            background: #0056b3;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
        }

        .delete-btn:hover {
            background: #a71e2a;
        }
        .dropdown-arrow {
            position: absolute;
            right: 4px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #999;
            font-size: 14px;
            padding: 12px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .splash-content {
            text-align: center;
            color: white;
            padding: 40px;
        }

        .splash-content h1 {
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 30px;
            animation: fadeInUp 0.8s ease-out;
        }

        .splash-message {
            font-size: 16px;
            font-weight: 400;
            margin-bottom: 40px;
            opacity: 0.95;
            line-height: 1.6;
            animation: fadeInUp 1s ease-out 0.2s both;
        }

        .splash-message p {
            margin-bottom: 8px;
        }

        .loading-bar {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            margin: 0 auto;
            overflow: hidden;
            animation: fadeInUp 1.2s ease-out 0.4s both;
        }

        .loading-progress {
            width: 0;
            height: 100%;
            background: white;
            border-radius: 2px;
            animation: loadingBar 3s ease-out forwards;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes loadingBar {
            to {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- ì´ˆê¸° ì•ˆë‚´ í™”ë©´ -->
    <div id="splash-screen" class="splash-screen">
        <div class="splash-content">
            <h1>ğŸ’° ë¨¸ë‹ˆì•±</h1>
            <div class="splash-message">
                <p>ë™ë„¤ë§ˆë‹¤ ì œí’ˆ ê°€ê²© ì°¨ì´ê°€ ìˆì–´ìš”.</p>
                <p>ìì£¼ êµ¬ì…í•˜ëŠ” ë¬¼í’ˆì˜ ìƒí’ˆëª…, ê¸ˆì•¡ì„</p>
                <p>ë¨¸ë‹ˆì•±ì— ê¸°ë¡í•˜ë©´ [ë‹¨ìœ„ ë‹¨ê°€]ê°€ ë‚˜íƒ€ë‚˜ìš”.</p>
                <p>ì €ë ´í•œ ê³³ì„ ì´ìš©í•˜ì—¬</p>
                <p>ë§¤ì¼ë§¤ì¼ ëˆì„ ë²„ì„¸ìš”.</p>
            </div>
            <div class="loading-bar">
                <div class="loading-progress"></div>
            </div>
        </div>
    </div>

    <div class="container" id="main-app" style="display: none;">
        <div class="header">
            <h1>ğŸ’° ë¨¸ë‹ˆì•±</h1>
            <p>ë˜‘ë˜‘í•œ ê°€ê²© ë¹„êµë¡œ ì ˆì•½í•˜ì„¸ìš”</p>
        </div>
        
        <div class="content">
            <div class="tab-buttons">
                <button class="tab-btn active" onclick="switchTab('register')">ì œí’ˆë“±ë¡</button>
                <button class="tab-btn" onclick="switchTab('compare')">ì „ì²´ë¹„êµ</button>
            </div>

            <!-- ì œí’ˆ ë“±ë¡ íƒ­ -->
            <div id="register-tab" class="tab-content active">
                <div class="form-group">
                    <label class="form-label">ì œí’ˆëª…</label>
                    <div class="input-wrapper">
                        <input type="text" class="form-input" id="product-name" placeholder="ì˜ˆ: ì½œë¼" autocomplete="off" maxlength="20">
                        <span class="dropdown-arrow" data-toggle="product" onclick="toggleProductList()">â–¼</span>
                        <div id="product-suggestions" class="suggestion-box" style="display: none;"></div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">ìˆ˜í¼ì´ë¦„</label>
                    <div class="input-wrapper">
                        <input type="text" class="form-input" id="store-name" placeholder="ì˜ˆ: ë¡¯ë°ìˆ˜í¼" autocomplete="off" maxlength="20">
                        <span class="dropdown-arrow" data-toggle="store" onclick="toggleStoreList()">â–¼</span>
                        <div id="store-suggestions" class="suggestion-box" style="display: none;"></div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">ìƒí’ˆëª…</label>
                    <div class="input-wrapper">
                        <input type="text" class="form-input" id="brand-name" placeholder="ì˜ˆ: ì½”ì¹´ì½œë¼" autocomplete="off" maxlength="20">
                        <span class="dropdown-arrow" data-toggle="brand" onclick="toggleBrandList()">â–¼</span>
                        <div id="brand-suggestions" class="suggestion-box" style="display: none;"></div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">ìš©ëŸ‰</label>
                    <div class="unit-display">
                        <input type="number" class="form-input" id="volume" placeholder="ì˜ˆ: 500" style="flex: 2;">
                        <select class="form-input" id="unit" style="flex: 1; margin-left: 8px;">
                            <option value="ml">ml</option>
                            <option value="g">g</option>
                            <option value="kg">kg</option>
                            <option value="L">L</option>
                            <option value="ê°œ">ê°œ</option>
                            <option value="íŒ©">íŒ©</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">ê°€ê²©</label>
                    <div class="unit-display">
                        <input type="number" class="form-input" id="price" placeholder="ì˜ˆ: 1250">
                        <span class="unit-label">ì›</span>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">ë°°ì†¡ë£Œ</label>
                    <div class="unit-display">
                        <input type="number" class="form-input" id="shipping" placeholder="ì˜ˆ: 2500">
                        <span class="unit-label">ì›</span>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">ë‹¨ìœ„ë‹¨ê°€(ë°°ì†¡ë£Œ í¬í•¨ ê³„ì‚°ì…ë‹ˆë‹¤)</label>
                    <div class="unit-display">
                        <input type="text" class="form-input" id="unit-price" placeholder="ìë™ ê³„ì‚°ë©ë‹ˆë‹¤" readonly>
                        <span class="unit-label" id="unit-price-label">ì›/ml</span>
                    </div>
                </div>

                <button class="btn" onclick="registerProduct()">ë“±ë¡í•˜ê¸°</button>
<!-- ë°±ì—…/ë³µì› ë²„íŠ¼ -->
                <div style="margin-top: 20px; text-align: center;">
                    <button onclick="toggleDataManagement()" style="padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 6px; font-size: 11px; font-weight: 500;">ë°ì´í„° ê´€ë¦¬</button>
                    <div id="data-management" style="display: none; margin-top: 10px;">
                        <button onclick="exportData()" style="padding: 10px 16px; background: #28a745; color: white; border: none; border-radius: 8px; font-size: 12px; font-weight: 500; margin-right: 10px;">ğŸ“¤ ë°±ì—…</button>
                        <button onclick="handleRestore()" style="padding: 10px 16px; background: #dc3545; color: white; border: none; border-radius: 8px; font-size: 12px; font-weight: 500;">ğŸ“¥ ë³µì›</button>
                    </div>
                </div>
                <div class="history-section" id="history-section" style="display: none;">
                    <div class="history-title">ìµœê·¼ ë“±ë¡ ë‚´ì—­</div>
                    <div id="recent-history"></div>
                </div>
            </div>

            <!-- ì „ì²´ ë¹„êµ íƒ­ -->
            <div id="compare-tab" class="tab-content">
                <div class="form-group">
                    <label class="form-label">ë¹„êµí•  ì œí’ˆ ì„ íƒ()</label>
                    <select class="form-input" id="compare-product" onchange="showComparison()">
                        <option value="">ì œí’ˆì„ ì„ íƒí•˜ì„¸ìš”</option>
                    </select>
                </div>
                
                
                
                <div class="comparison-results" id="comparison-results">
                    <div class="empty-state">
                        <div style="font-size: 48px; margin-bottom: 16px;">ğŸ›’</div>
                        <p>ì œí’ˆì„ ì„ íƒí•˜ê³  ë¹„êµí•´ë³´ì„¸ìš”!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <input type="file" id="import-file" accept=".json" onchange="importData(event)" style="display: none;">
    
    <!-- ë³µì› í™•ì¸ ëª¨ë‹¬ -->
    <div id="restore-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 9999;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 15px; max-width: 300px; width: 90%; text-align: center;">
            <h3 style="margin-bottom: 20px; font-size: 16px; color: #dc3545; font-weight: 700;">âš ï¸ ë°ì´í„° ë³µì› ê²½ê³ </h3>
            <p style="font-size: 14px; color: #333; margin-bottom: 25px; line-height: 1.5;">ë³µì›í•˜ë©´ í˜„ì¬ ìë£Œê°€ ëª¨ë‘ ì‚¬ë¼ì§‘ë‹ˆë‹¤.<br>ê³„ì†í• ê¹Œìš”?</p>
            <div style="margin-top: 20px; text-align: center;">
                <button onclick="closeRestoreModal()" style="padding: 10px 20px; background: #ddd; color: #333; border: none; border-radius: 8px; cursor: pointer; margin-right: 10px; font-size: 12px;">ì·¨ì†Œ</button>
                <button onclick="confirmRestore()" style="padding: 10px 20px; background: #dc3545; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 12px;">í™•ì¸</button>
            </div>
        </div>
    </div>
    
    <script>
        // ì „ì—­ ë³€ìˆ˜
        let products = [];
        let productNames = new Set();
        let stores = new Set();
        let brands = new Set();
        let editingProductId = null;

        // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        function loadData() {
            try {
                products = JSON.parse(localStorage.getItem('products') || '[]');
                productNames = new Set(JSON.parse(localStorage.getItem('productNames') || '[]'));
                stores = new Set(JSON.parse(localStorage.getItem('stores') || '[]'));
                brands = new Set(JSON.parse(localStorage.getItem('brands') || '[]'));
                console.log('ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', products.length + 'ê°œ ì œí’ˆ');
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                products = [];
                productNames = new Set();
                stores = new Set();
                brands = new Set();
            }
        }

        // ë°ì´í„° ì €ì¥
        function saveData() {
            try {
                localStorage.setItem('products', JSON.stringify(products));
                localStorage.setItem('productNames', JSON.stringify([...productNames]));
                localStorage.setItem('stores', JSON.stringify([...stores]));
                localStorage.setItem('brands', JSON.stringify([...brands]));
                console.log('ë°ì´í„° ì €ì¥ ì™„ë£Œ');
            } catch (error) {
                console.error('ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:', error);
            }
        }

        // ë‹¨ìœ„ê°€ê²© ìë™ ê³„ì‚° ì„¤ì •
        function setupCalculation() {
            const volumeInput = document.getElementById('volume');
            const priceInput = document.getElementById('price');
            const shippingInput = document.getElementById('shipping');
            const unitInput = document.getElementById('unit');
            const unitPriceInput = document.getElementById('unit-price');
            const unitPriceLabel = document.getElementById('unit-price-label');

            function calculateUnitPrice() {
                const volume = parseFloat(volumeInput.value);
                const price = parseFloat(priceInput.value);
                const shipping = parseFloat(shippingInput.value) || 0;
                const unit = unitInput.value;
                
                console.log('ê³„ì‚° ì¤‘:', { volume, price, shipping, unit });
                
                if (volume && price && volume > 0 && price > 0) {
                    const totalPrice = price + shipping;
                    const unitPrice = (totalPrice / volume).toFixed(2);
                    unitPriceInput.value = unitPrice;
                    unitPriceLabel.textContent = `ì›/${unit}`;
                    console.log('ë‹¨ìœ„ê°€ê²© ê³„ì‚°ë¨:', unitPrice + 'ì›/' + unit);
                } else {
                    unitPriceInput.value = '';
                    unitPriceLabel.textContent = `ì›/${unit}`;
                }
            }

            // ì¦‰ì‹œ ê³„ì‚° ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
            if (volumeInput && priceInput && shippingInput && unitInput) {
                volumeInput.addEventListener('input', calculateUnitPrice);
                priceInput.addEventListener('input', calculateUnitPrice);
                shippingInput.addEventListener('input', calculateUnitPrice);
                unitInput.addEventListener('change', calculateUnitPrice);
                
                // í˜ì´ì§€ ë¡œë“œì‹œ ì¦‰ì‹œ ê³„ì‚° ì‹œë„
                calculateUnitPrice();
                
                console.log('ê³„ì‚° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì™„ë£Œ');
            } else {
                console.error('ì…ë ¥ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
            }
        }

        // ìë™ì™„ì„± ê¸°ëŠ¥ ì„¤ì •
        function setupAutoComplete() {
            setupSuggestions('product-name', 'product-suggestions', Array.from(productNames), handleProductSelection);
            setupSuggestions('store-name', 'store-suggestions', Array.from(stores));
            setupSuggestions('brand-name', 'brand-suggestions', Array.from(brands));
        }

        function setupSuggestions(inputId, suggestionsId, dataArray, onSelect = null) {
            const input = document.getElementById(inputId);
            const suggestions = document.getElementById(suggestionsId);

            if (!input || !suggestions) return;

            input.addEventListener('input', function() {
                const value = this.value.toLowerCase();
                if (value.length === 0) {
                    suggestions.style.display = 'none';
                    return;
                }
                
                const matches = dataArray.filter(item => 
                    item.toLowerCase().includes(value)
                ).slice(0, 5); // ìµœëŒ€ 5ê°œë§Œ í‘œì‹œ
                
                if (matches.length > 0) {
                    suggestions.innerHTML = matches.map(item => 
                        `<div class="suggestion-item" onclick="selectSuggestion('${inputId}', '${item}', ${onSelect ? 'true' : 'false'})">${item}</div>`
                    ).join('');
                    suggestions.style.display = 'block';
                } else {
                    suggestions.style.display = 'none';
                }
            });

            input.addEventListener('blur', function(e) {
                // ë“œë¡­ë‹¤ìš´ í™”ì‚´í‘œ í´ë¦­ì‹œì—ëŠ” ë‹«ì§€ ì•ŠìŒ
                if (e.relatedTarget && e.relatedTarget.classList.contains('dropdown-arrow')) {
                    return;
                }
                setTimeout(() => suggestions.style.display = 'none', 200);
            });

           
        }

        function selectSuggestion(inputId, value, hasCallback) {
            document.getElementById(inputId).value = value;
            document.getElementById(inputId.replace('-name', '-suggestions')).style.display = 'none';
            
            if (hasCallback && inputId === 'product-name') {
                handleProductSelection(value);
            }
        }

        function handleProductSelection(productName) {
            // í•´ë‹¹ ì œí’ˆì˜ ìµœê·¼ ë°ì´í„° í‘œì‹œ
            const relatedProducts = products.filter(p => p.productName === productName);
            if (relatedProducts.length > 0) {
                const latest = relatedProducts[relatedProducts.length - 1];
                // ì´ì „ ì…ë ¥ ì •ë³´ë¥¼ íŒíŠ¸ë¡œ í‘œì‹œí•  ìˆ˜ ìˆìŒ
                console.log('ì´ì „ ì…ë ¥ëœ ìƒí’ˆ ì •ë³´:', latest);
            }
        }

        // ì œí’ˆ ë“±ë¡
        function registerProduct() {
            console.log('ë“±ë¡ í•¨ìˆ˜ í˜¸ì¶œë¨');
            
            const productName = document.getElementById('product-name').value.trim();
            const storeName = document.getElementById('store-name').value.trim() || '-';
            const brandName = document.getElementById('brand-name').value.trim() || '-';
            const volume = parseFloat(document.getElementById('volume').value) || 0;
            const price = parseFloat(document.getElementById('price').value) || 0;
            const shipping = parseFloat(document.getElementById('shipping').value) || 0;
            const unit = document.getElementById('unit').value;

            // ë“±ë¡ ë²„íŠ¼ í´ë¦­ì‹œ ë‹¨ìœ„ë‹¨ê°€ ê³„ì‚° ë° í‘œì‹œ
            if (volume > 0 && price > 0) {
                const totalPrice = price + shipping;
                const unitPrice = (totalPrice / volume).toFixed(2);
                document.getElementById('unit-price').value = unitPrice;
                document.getElementById('unit-price-label').textContent = `ì›/${unit}`;
                console.log('ë‹¨ìœ„ë‹¨ê°€ ê³„ì‚°ë¨:', unitPrice + 'ì›/' + unit);
            }

            console.log('ì…ë ¥ê°’:', { productName, storeName, brandName, volume, price, shipping, unit });

            // ìµœì†Œ ìœ íš¨ì„± ê²€ì‚¬ - ì œí’ˆëª…ë§Œ í•„ìˆ˜
            if (!productName) {
                alert('ì œí’ˆëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                document.getElementById('product-name').focus();
                return;
            }

            // ë‹¨ìœ„ê°€ê²© ê³„ì‚° (ìš©ëŸ‰ê³¼ ê°€ê²©ì´ ìˆì„ ë•Œë§Œ)
            let unitPrice = 0;
            if (volume > 0 && price > 0) {
                const totalPrice = price + shipping;
                unitPrice = Math.round((totalPrice / volume) * 100) / 100;
            }

            // ìƒˆ ì œí’ˆ ê°ì²´ ìƒì„±
            const newProduct = {
                id: Date.now(),
                productName: productName,
                storeName: storeName,
                brandName: brandName,
                volume: volume,
                price: price,
                shipping: shipping,
                unit: unit,
                unitPrice: unitPrice,
                createdAt: new Date().toLocaleString()
            };

            console.log('ì €ì¥í•  ì œí’ˆ:', newProduct);

            // ìˆ˜ì • ëª¨ë“œì¼ ë•Œ ì²˜ë¦¬
            if (editingProductId !== null) {
                const originalProduct = products.find(p => p.id === editingProductId);
                
                const hasChanges = originalProduct.productName !== productName ||
                                 originalProduct.storeName !== storeName ||
                                 originalProduct.brandName !== brandName ||
                                 originalProduct.volume !== volume ||
                                 originalProduct.price !== price ||
                                 originalProduct.shipping !== shipping ||
                                 originalProduct.unit !== unit;

                if (hasChanges) {
                    products = products.filter(p => p.id !== editingProductId);
                    products.push(newProduct);
                    productNames.add(productName);
                    if (storeName !== '-') stores.add(storeName);
                    if (brandName !== '-') brands.add(brandName);
                    saveData();
                    updateCompareOptions();
                    updateHistory();
                    setupAutoComplete();
                    alert('ì œí’ˆì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!\në‹¨ìœ„ë‹¨ê°€: ' + (unitPrice > 0 ? unitPrice + 'ì›/' + unit : 'ê³„ì‚° ë¶ˆê°€'));
                    
                    // ìˆ˜ì • ì™„ë£Œ í›„ ìë™ìœ¼ë¡œ ë¹„êµ í™”ë©´ í‘œì‹œ
                    setTimeout(() => {
                        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                        document.querySelectorAll('.tab-btn')[1].classList.add('active');
                        document.getElementById('compare-tab').classList.add('active');
                        
                        document.getElementById('compare-product').value = window.currentSelectedProduct;
                        showComparison();
                        window.currentSelectedProduct = null;
                    }, 1000);
                } else {
                    alert('ë³€ê²½ëœ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.');
                    editingProductId = null;
                    clearForm();
                    return;
                }
                
                editingProductId = null;
            } else {
                products.push(newProduct);
                productNames.add(productName);
                if (storeName !== '-') stores.add(storeName);
                if (brandName !== '-') brands.add(brandName);
                saveData();
                updateCompareOptions();
                updateHistory();
                setupAutoComplete();
                alert('ì œí’ˆì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!\në‹¨ìœ„ë‹¨ê°€: ' + (unitPrice > 0 ? unitPrice + 'ì›/' + unit : 'ê³„ì‚° ë¶ˆê°€'));
            } // ìë™ì™„ì„± ë°ì´í„° ì—…ë°ì´íŠ¸

            // 3ì´ˆ í›„ í¼ ì´ˆê¸°í™” (ë‹¨ìœ„ë‹¨ê°€ë¥¼ ë³¼ ì‹œê°„ì„ ì¤Œ)
            setTimeout(() => {
                clearForm();
            }, 3000);
            console.log('ë“±ë¡ ì™„ë£Œ, í˜„ì¬ ì œí’ˆ ìˆ˜:', products.length);
        }

        // í¼ ì´ˆê¸°í™”
        function clearForm() {
            document.getElementById('product-name').value = '';
            document.getElementById('store-name').value = '';
            document.getElementById('brand-name').value = '';
            document.getElementById('volume').value = '';
            document.getElementById('price').value = '';
            document.getElementById('shipping').value = '';
            document.getElementById('unit').value = 'ml';
            document.getElementById('unit-price').value = '';
            document.getElementById('unit-price-label').textContent = 'ì›/ml';
            
            // ìˆ˜ì • ëª¨ë“œ í•´ì œ
            editingProductId = null;
            
            // ìë™ì™„ì„± ì°½ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.suggestion-box').forEach(box => {
                box.style.display = 'none';
            });
            
            // ì²« ë²ˆì§¸ í•„ë“œë¡œ í¬ì»¤ìŠ¤
            document.getElementById('product-name').focus();
        }

        // íƒ­ ì „í™˜
        function switchTab(tabName) {
            // ëª¨ë“  íƒ­ ë²„íŠ¼ê³¼ ë‚´ìš© ì´ˆê¸°í™”
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // ì„ íƒëœ íƒ­ í™œì„±í™”
            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // ë°ì´í„° ê´€ë¦¬ ë©”ë‰´ ìˆ¨ê¸°ê¸°
            document.getElementById('data-management').style.display = 'none';
        }

        // ë¹„êµ ì˜µì…˜ ì—…ë°ì´íŠ¸
        function updateCompareOptions() {
            const select = document.getElementById('compare-product');
            const uniqueProducts = [...new Set(products.map(p => p.productName))];
            
            select.innerHTML = '<option value="">ì œí’ˆì„ ì„ íƒí•˜ì„¸ìš”</option>' + 
                uniqueProducts.map(product => `<option value="${product}">${product}</option>`).join('');
        }

        // ìµœê·¼ ë“±ë¡ ë‚´ì—­ ì—…ë°ì´íŠ¸ (ì‚¬ìš© ì•ˆí•¨)
        function updateHistory() {
            // ìµœê·¼ ë“±ë¡ ë‚´ì—­ì„ í‘œì‹œí•˜ì§€ ì•ŠìŒ
            const historySection = document.getElementById('history-section');
            historySection.style.display = 'none';
        }

        // ê°€ê²© ë¹„êµ í‘œì‹œ
        function showComparison() {
            const selectedProduct = document.getElementById('compare-product').value;
            const resultsContainer = document.getElementById('comparison-results');
            
            if (!selectedProduct) {
                resultsContainer.innerHTML = `
                    <div class="empty-state">
                        <div style="font-size: 48px; margin-bottom: 16px;">ğŸ›’</div>
                        <p>ì œí’ˆì„ ì„ íƒí•˜ê³  ë¹„êµí•´ë³´ì„¸ìš”!</p>
                    </div>
                `;
                return;
            }

            const relatedProducts = products.filter(p => p.productName === selectedProduct);
            
            if (relatedProducts.length === 0) {
                resultsContainer.innerHTML = `
                    <div class="empty-state">
                        <div style="font-size: 48px; margin-bottom: 16px;">ğŸ˜…</div>
                        <p>ë“±ë¡ëœ ${selectedProduct} ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                `;
                return;
            }

            // ë‹¨ìœ„ê°€ê²© ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬
            relatedProducts.sort((a, b) => a.unitPrice - b.unitPrice);
            
            resultsContainer.innerHTML = relatedProducts.map((product, index) => `
                <div class="result-item ${index === 0 && product.unitPrice > 0 ? 'best' : ''}">
                    <div class="result-header">
                        <div>
                            <span class="result-store">${product.storeName}</span>
                            ${index === 0 && product.unitPrice > 0 ? '<span class="best-badge">ìµœì €ê°€</span>' : ''}
                        </div>
                        <div class="result-price">${product.unitPrice > 0 ? product.unitPrice + 'ì›/' + (product.unit || 'ml') : 'ê°€ê²©ì •ë³´ ì—†ìŒ'}</div>
                    </div>
                    <div class="result-details">
                        <span>${product.brandName} ${product.volume > 0 ? product.volume + (product.unit || 'ml') : ''}</span>
                        <span>${product.price > 0 ? (product.price + (product.shipping || 0)) + 'ì›' : 'ê°€ê²©ì •ë³´ ì—†ìŒ'}</span>
                    </div>
                    <div class="result-actions">
                        <button class="edit-btn" data-id="${product.id}" type="button">ìˆ˜ì •</button>
                        <button class="delete-btn" data-id="${product.id}" type="button">ì‚­ì œ</button>
                    </div>
                </div>
            `).join('');
            
            // ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            resultsContainer.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-id'));
                    editProduct(productId);
                });
            });
            
            resultsContainer.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-id'));
                    deleteProduct(productId);
                });
            });
        }

        // ì œí’ˆ ìˆ˜ì •
        function editProduct(productId) {
            console.log('ìˆ˜ì • í•¨ìˆ˜ í˜¸ì¶œ, ID:', productId);
            const product = products.find(p => p.id === productId);
            if (!product) {
                alert('ì œí’ˆì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // í˜„ì¬ ê°’ë“¤ì„ ì…ë ¥ í¼ì— ì±„ìš°ê¸°
            document.getElementById('product-name').value = product.productName || '';
            document.getElementById('store-name').value = product.storeName === '-' ? '' : product.storeName;
            document.getElementById('brand-name').value = product.brandName === '-' ? '' : product.brandName;
            document.getElementById('volume').value = product.volume || '';
            document.getElementById('price').value = product.price || '';
            document.getElementById('shipping').value = product.shipping || '';
            document.getElementById('unit').value = product.unit || 'ml';
            
            // ë‹¨ìœ„ë‹¨ê°€ í‘œì‹œ
            if (product.unitPrice > 0) {
                document.getElementById('unit-price').value = product.unitPrice;
                document.getElementById('unit-price-label').textContent = `ì›/${product.unit || 'ml'}`;
            }

            // ì œí’ˆë“±ë¡ íƒ­ìœ¼ë¡œ ì´ë™
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.querySelectorAll('.tab-btn')[0].classList.add('active');
            document.getElementById('register-tab').classList.add('active');

            // ìˆ˜ì • ëª¨ë“œ ì„¤ì •
            editingProductId = productId;
            
            // í˜„ì¬ ì„ íƒëœ ì œí’ˆëª… ì €ì¥ (ìˆ˜ì • í›„ ìë™ ë¹„êµìš©)
            window.currentSelectedProduct = product.productName;

            alert('ìˆ˜ì •í•  ë‚´ìš©ì„ ì…ë ¥í•˜ê³  ë“±ë¡í•˜ê¸° ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.');
        }

        // ì œí’ˆ ì‚­ì œ
        function deleteProduct(productId) {
            console.log('ì‚­ì œ í•¨ìˆ˜ í˜¸ì¶œ, ID:', productId);
            const product = products.find(p => p.id === productId);
            if (!product) {
                alert('ì œí’ˆì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            if (confirm(`${product.brandName} (${product.storeName}) ì •ë³´ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                products = products.filter(p => p.id !== productId);
                saveData();
                showComparison();
                updateCompareOptions();
                updateHistory();
                alert('ì œí’ˆì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // í˜ì´ì§€ ë¡œë“œì‹œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        // ë“œë¡­ë‹¤ìš´ í™”ì‚´í‘œ í´ë¦­ì‹œ ì œí’ˆëª… ëª©ë¡ í‘œì‹œ/ìˆ¨ê¹€
        function toggleProductList() {
            const suggestions = document.getElementById('product-suggestions');
            if (suggestions.style.display === 'none' || suggestions.style.display === '') {
                if (productNames.size > 0) {
                    suggestions.innerHTML = Array.from(productNames).map(item => 
                        `<div class="suggestion-item">
                            <div class="suggestion-item-with-delete">
                                <span class="suggestion-text" onclick="selectSuggestion('product-name', '${item}', true)">${item}</span>
                                <button class="delete-suggestion-btn" onclick="deleteProductName('${item}')">ì‚­ì œ</button>
                            </div>
                        </div>`
                    ).join('');
                    suggestions.style.display = 'block';
                }
            } else {
                suggestions.style.display = 'none';
            }
        }

        // í˜ì´ì§€ ë¡œë“œì‹œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        

        // ë“œë¡­ë‹¤ìš´ í™”ì‚´í‘œ í´ë¦­ì‹œ ìˆ˜í¼ì´ë¦„ ëª©ë¡ í‘œì‹œ/ìˆ¨ê¹€
        function toggleStoreList() {
            const suggestions = document.getElementById('store-suggestions');
            if (suggestions.style.display === 'none' || suggestions.style.display === '') {
                if (stores.size > 0) {
                    suggestions.innerHTML = Array.from(stores).map(item => 
                        `<div class="suggestion-item">
                            <div class="suggestion-item-with-delete">
                                <span class="suggestion-text" onclick="selectSuggestion('store-name', '${item}', false)">${item}</span>
                                <button class="delete-suggestion-btn" onclick="deleteStoreName('${item}')">ì‚­ì œ</button>
                            </div>
                        </div>`
                    ).join('');
                    suggestions.style.display = 'block';
                }
            } else {
                suggestions.style.display = 'none';
            }
        }

        
        // ë“œë¡­ë‹¤ìš´ í™”ì‚´í‘œ í´ë¦­ì‹œ ìƒí’ˆëª… ëª©ë¡ í‘œì‹œ/ìˆ¨ê¹€ (í•´ë‹¹ ì œí’ˆëª… ê¸°ì¤€)
        function toggleBrandList() {
            const suggestions = document.getElementById('brand-suggestions');
            const productName = document.getElementById('product-name').value.trim();
            
            if (suggestions.style.display === 'none' || suggestions.style.display === '') {
                if (productName) {
                    // í•´ë‹¹ ì œí’ˆëª…ì— í•´ë‹¹í•˜ëŠ” ìƒí’ˆëª…ë“¤ë§Œ í•„í„°ë§
                    const relatedBrands = products
                        .filter(p => p.productName === productName)
                        .map(p => p.brandName)
                        .filter(brand => brand !== '-');
                    
                    const uniqueBrands = [...new Set(relatedBrands)];
                    
                    if (uniqueBrands.length > 0) {
                        suggestions.innerHTML = uniqueBrands.map(item => 
                            `<div class="suggestion-item">
                                <div class="suggestion-item-with-delete">
                                    <span class="suggestion-text" onclick="selectSuggestion('brand-name', '${item}', false)">${item}</span>
                                    <button class="delete-suggestion-btn" onclick="deleteBrandName('${item}')">ì‚­ì œ</button>
                                </div>
                            </div>`
                        ).join('');
                        suggestions.style.display = 'block';
                    } else {
                        alert('í•´ë‹¹ ì œí’ˆëª…ì— ë“±ë¡ëœ ìƒí’ˆëª…ì´ ì—†ìŠµë‹ˆë‹¤.');
                    }
                } else {
                    alert('ë¨¼ì € ì œí’ˆëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                }
            } else {
                suggestions.style.display = 'none';
            }
        }
        
        // ì œí’ˆëª… ì‚­ì œ í•¨ìˆ˜
        function deleteProductName(productName) {
            if (confirm(`"${productName}" ì œí’ˆëª…ê³¼ ê´€ë ¨ëœ ëª¨ë“  ìë£Œê°€ ì‚­ì œë©ë‹ˆë‹¤.\n\ní™•ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                // í•´ë‹¹ ì œí’ˆëª…ì˜ ëª¨ë“  ìƒí’ˆ ì‚­ì œ
                products = products.filter(p => p.productName !== productName);
                productNames.delete(productName);
                
                // ë°ì´í„° ì €ì¥ ë° UI ì—…ë°ì´íŠ¸
                saveData();
                updateCompareOptions();
                updateHistory();
                setupAutoComplete();
                
                // ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
                document.getElementById('product-suggestions').style.display = 'none';
                
                alert(`"${productName}" ì œí’ˆëª…ê³¼ ê´€ë ¨ëœ ëª¨ë“  ìë£Œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
            }
        }

        // ìˆ˜í¼ì´ë¦„ ì‚­ì œ í•¨ìˆ˜
        function deleteStoreName(storeName) {
            if (confirm(`"${storeName}" ìˆ˜í¼ì´ë¦„ê³¼ ê´€ë ¨ëœ ëª¨ë“  ìë£Œê°€ ì‚­ì œë©ë‹ˆë‹¤.\n\ní™•ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                // í•´ë‹¹ ìˆ˜í¼ì´ë¦„ì˜ ëª¨ë“  ìƒí’ˆ ì‚­ì œ
                products = products.filter(p => p.storeName !== storeName);
                stores.delete(storeName);
                
                // ë°ì´í„° ì €ì¥ ë° UI ì—…ë°ì´íŠ¸
                saveData();
                updateCompareOptions();
                updateHistory();
                setupAutoComplete();
                
                // ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
                document.getElementById('store-suggestions').style.display = 'none';
                
                alert(`"${storeName}" ìˆ˜í¼ì´ë¦„ê³¼ ê´€ë ¨ëœ ëª¨ë“  ìë£Œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
            }
        }

        // ìƒí’ˆëª… ì‚­ì œ í•¨ìˆ˜
        function deleteBrandName(brandName) {
            if (confirm(`"${brandName}" ìƒí’ˆëª…ê³¼ ê´€ë ¨ëœ ëª¨ë“  ìë£Œê°€ ì‚­ì œë©ë‹ˆë‹¤.\n\ní™•ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                // í•´ë‹¹ ìƒí’ˆëª…ì˜ ëª¨ë“  ìƒí’ˆ ì‚­ì œ
                products = products.filter(p => p.brandName !== brandName);
                brands.delete(brandName);
                
                // ë°ì´í„° ì €ì¥ ë° UI ì—…ë°ì´íŠ¸
                saveData();
                updateCompareOptions();
                updateHistory();
                setupAutoComplete();
                
                // ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
                document.getElementById('brand-suggestions').style.display = 'none';
                
                alert(`"${brandName}" ìƒí’ˆëª…ê³¼ ê´€ë ¨ëœ ëª¨ë“  ìë£Œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
            }
        }
        // ë°ì´í„° ê´€ë¦¬ ë©”ë‰´ í† ê¸€
        function toggleDataManagement() {
            const menu = document.getElementById('data-management');
            if (menu.style.display === 'none' || menu.style.display === '') {
                menu.style.display = 'flex';
            } else {
                menu.style.display = 'none';
            }
        }

        // ë³µì› ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜
        function handleRestore() {
            document.getElementById('restore-modal').style.display = 'block';
        }
        
        function closeRestoreModal() {
            document.getElementById('restore-modal').style.display = 'none';
        }
        
        function confirmRestore() {
            closeRestoreModal();
            document.getElementById('import-file').click();
        }
        // ë°ì´í„° ë°±ì—… í•¨ìˆ˜
        function exportData() {
            try {
                const allData = {
                    products: products,
                    productNames: [...productNames],
                    stores: [...stores],
                    brands: [...brands],
                    exportDate: new Date().toLocaleString()
                };
                
                const dataStr = JSON.stringify(allData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                
                // í˜„ì¬ ì‹œê°„ìœ¼ë¡œ íŒŒì¼ëª… ìƒì„±
                const now = new Date();
                const timestamp = now.getFullYear() + '-' + 
                    String(now.getMonth() + 1).padStart(2, '0') + '-' + 
                    String(now.getDate()).padStart(2, '0') + '_' +
                    String(now.getHours()).padStart(2, '0') + 
                    String(now.getMinutes()).padStart(2, '0');
                
                link.download = 'moneyapp_backup_' + timestamp + '.json';
                
                // DOMì— ì¶”ê°€ í›„ í´ë¦­
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                alert('ë°ì´í„°ê°€ ë°±ì—…ë˜ì—ˆìŠµë‹ˆë‹¤.\níŒŒì¼ëª…: ' + link.download);
            } catch (error) {
                alert('ë°±ì—… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ë°ì´í„° ë³µì› í•¨ìˆ˜
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (confirm('ê¸°ì¡´ ë°ì´í„°ê°€ ëª¨ë‘ ì‚­ì œë˜ê³  ë°±ì—… ë°ì´í„°ë¡œ ë³µì›ë©ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const backupData = JSON.parse(e.target.result);
                        products = backupData.products || [];
                        productNames = new Set(backupData.productNames || []);
                        stores = new Set(backupData.stores || []);
                        brands = new Set(backupData.brands || []);
                        saveData();
                        updateCompareOptions();
                        updateHistory();
                        setupAutoComplete();
                        
                        // í¼ ì´ˆê¸°í™”
                        clearForm();
                        
                        // ë¹„êµ í™”ë©´ ì´ˆê¸°í™”
                        document.getElementById('comparison-results').innerHTML = `
                            <div class="empty-state">
                                <div style="font-size: 48px; margin-bottom: 16px;">ğŸ›’</div>
                                <p>ì œí’ˆì„ ì„ íƒí•˜ê³  ë¹„êµí•´ë³´ì„¸ìš”!</p>
                            </div>
                        `;
                        
                        alert('ë°ì´í„°ê°€ ë³µì›ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    } catch (error) {
                        alert('ë°±ì—… íŒŒì¼ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                    }
                };
                reader.readAsText(file);
            }
            
            // íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™”
            event.target.value = '';
        }
        window.onload = function() {
            // 3ì´ˆ í›„ ì´ˆê¸° í™”ë©´ ìˆ¨ê¸°ê³  ë©”ì¸ ì•± í‘œì‹œ
            setTimeout(() => {
                document.getElementById('splash-screen').style.display = 'none';
                document.getElementById('main-app').style.display = 'block';
                // ë°ì´í„° ê´€ë¦¬ ë©”ë‰´ í™•ì‹¤íˆ ìˆ¨ê¸°ê¸°
                document.getElementById('data-management').style.display = 'none';
            }, 3000);
            

            loadData();
            setupCalculation();
            setupAutoComplete();
            updateCompareOptions();
            updateHistory();

            // ì…ë ¥ í•„ë“œ 20ì ì œí•œ (ì‹¤ì‹œê°„)
            document.getElementById('product-name').addEventListener('input', function(e) {
                if (this.value.length > 20) {
                    this.value = this.value.substring(0, 20);
                }
            });
            
            document.getElementById('store-name').addEventListener('input', function(e) {
                if (this.value.length > 20) {
                    this.value = this.value.substring(0, 20);
                }
            });
            
            document.getElementById('brand-name').addEventListener('input', function(e) {
                if (this.value.length > 20) {
                    this.value = this.value.substring(0, 20);
                }
            });
            // ë“œë¡­ë‹¤ìš´ í„°ì¹˜ ì´ë²¤íŠ¸ ê°œì„ 
            document.querySelectorAll('.dropdown-arrow').forEach(arrow => {
                arrow.addEventListener('touchend', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const toggle = this.getAttribute('data-toggle');
                    if (toggle === 'product') toggleProductList();
                    else if (toggle === 'store') toggleStoreList();
                    else if (toggle === 'brand') toggleBrandList();
                });
            });
        };
    </script>
</body>
</html>
